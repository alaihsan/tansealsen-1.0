<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riwayat Pelanggaran - {{ student_name }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#667eea',
                        secondary: '#764ba2',
                        success: '#48bb78',
                        danger: '#f56565',
                        warning: '#ed8936'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen flex flex-col h-screen">
        <!-- Top Navigation Bar -->
        <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-40">
            <div class="px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <!-- Logo and Title -->
                    <div class="flex items-center">
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">
                            Riwayat Pelanggaran
                        </h1>
                        <span class="ml-3 text-lg font-medium text-gray-600">{{ student_name }}</span>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex items-center space-x-3">
                        <a href="{{ url_for('main.home') }}" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-gray-500 to-gray-600 text-white text-sm font-medium rounded-lg hover:shadow-lg transition-all duration-200 hover:scale-105">
                            <i class="fas fa-arrow-left mr-2"></i>
                            Kembali ke Daftar Utama
                        </a>
                        <a href="{{ url_for('main.logout') }}" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-danger to-red-600 text-white text-sm font-medium rounded-lg hover:shadow-lg transition-all duration-200 hover:scale-105">
                            <i class="fas fa-sign-out-alt mr-2"></i>
                            Logout
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <div class="flex flex-1 overflow-hidden">
            <!-- Left Sidebar for Student Statistics -->
            <aside class="w-80 bg-white shadow-lg border-r border-gray-200 flex flex-col">
                <div class="flex-1 overflow-y-auto p-6">
                    <div class="space-y-6">
                        <!-- Student Info -->
                        <div class="bg-gradient-to-br from-primary/10 to-secondary/10 rounded-lg p-4 border border-primary/20">
                            <h3 class="text-sm font-semibold text-gray-900 mb-3 flex items-center">
                                <i class="fas fa-user-graduate mr-2 text-primary"></i>
                                Informasi Siswa
                            </h3>
                            <div class="text-center mb-4">
                                <div class="w-16 h-16 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center mx-auto mb-3">
                                    <i class="fas fa-user text-white text-2xl"></i>
                                </div>
                                <h4 class="font-semibold text-gray-900">{{ student_name }}</h4>
                                <p class="text-sm text-gray-600">Total Pelanggaran: {{ violations|length }}</p>
                            </div>
                        </div>

                        <!-- Category Statistics -->
                        <div class="bg-gradient-to-br from-primary/10 to-secondary/10 rounded-lg p-4 border border-primary/20">
                            <h3 class="text-sm font-semibold text-gray-900 mb-3 flex items-center justify-between">
                                <div class="flex items-center">
                                    <i class="fas fa-chart-pie mr-2 text-primary"></i>
                                    Statistik Pelanggaran
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button id="toggleStudentStats" class="text-xs text-primary hover:text-primary/80 transition-colors" title="Toggle Global/Student Stats">
                                        <i class="fas fa-globe mr-1"></i>
                                        <span id="studentStatsMode">Global</span>
                                    </button>
                                </div>
                            </h3>
                            <div class="space-y-3 text-sm">
                                <!-- Global Statistics -->
                                <div id="globalStudentStats" class="space-y-2">
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center">
                                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                            <span class="text-gray-600">Ringan:</span>
                                        </div>
                                        <span class="font-semibold text-gray-900">{{ total_ringan if total_ringan is defined else 0 }}</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center">
                                            <span class="w-2 h-2 bg-orange-500 rounded-full mr-2"></span>
                                            <span class="text-gray-600">Sedang:</span>
                                        </div>
                                        <span class="font-semibold text-gray-900">{{ total_sedang if total_sedang is defined else 0 }}</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center">
                                            <span class="w-2 h-2 bg-red-700 rounded-full mr-2"></span>
                                            <span class="text-gray-600">Berat:</span>
                                        </div>
                                        <span class="font-semibold text-gray-900">{{ total_berat if total_berat is defined else 0 }}</span>
                                    </div>
                                </div>
                                
                                <!-- Student Statistics -->
                                <div id="currentStudentStats" class="space-y-2 hidden">
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center">
                                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                            <span class="text-gray-600">Ringan:</span>
                                        </div>
                                        <span class="font-semibold text-gray-900" id="student-stat-ringan">0</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center">
                                            <span class="w-2 h-2 bg-orange-500 rounded-full mr-2"></span>
                                            <span class="text-gray-600">Sedang:</span>
                                        </div>
                                        <span class="font-semibold text-gray-900" id="student-stat-sedang">0</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center">
                                            <span class="w-2 h-2 bg-red-700 rounded-full mr-2"></span>
                                            <span class="text-gray-600">Berat:</span>
                                        </div>
                                        <span class="font-semibold text-gray-900" id="student-stat-berat">0</span>
                                    </div>
                                </div>

                                <!-- Progress Bar -->
                                <div class="pt-2 border-t border-primary/20">
                                    <div class="relative">
                                        <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden flex" id="student-category-progress">
                                            <div class="h-2 transition-all duration-500 flex-shrink-0" style="width: 0%; background-color: #22c55e;"></div>
                                            <div class="h-2 transition-all duration-500 flex-shrink-0" style="width: 0%; background-color: #f97316;"></div>
                                            <div class="h-2 transition-all duration-500 flex-shrink-0" style="width: 0%; background-color: #b91c1c;"></div>
                                        </div>
                                        <div class="flex justify-between mt-1 text-xs text-gray-500">
                                            <span>Ringan</span>
                                            <span>Sedang</span>
                                            <span>Berat</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Additional spacing for scroll -->
                        <div class="h-32"></div>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="flex-1 overflow-y-auto p-6">

                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        <div class="mb-6 space-y-2">
                            {% for category, message in messages %}
                                <div class="alert 
                                    {% if category == 'success' %}bg-green-100 border-green-400 text-green-700{% endif %}
                                    {% if category == 'error' %}bg-red-100 border-red-400 text-red-700{% endif %}
                                    {% if category == 'warning' %}bg-yellow-100 border-yellow-400 text-yellow-700{% endif %}
                                    px-4 py-3 rounded-lg border flex items-center" role="alert">
                                    <i class="fas 
                                        {% if category == 'success' %}fa-check-circle{% endif %}
                                        {% if category == 'error' %}fa-exclamation-circle{% endif %}
                                        {% if category == 'warning' %}fa-exclamation-triangle{% endif %}
                                        mr-3"></i>
                                    <span>{{ message }}</span>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endwith %}

                <!-- Violation List - List View for History -->
                {% if violations %}
                    <div class="violation-list space-y-4">
                        {% for p in violations %}
                            <div class="violation-item bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100" 
                                 data-id="{{ p.id }}"
                                 data-nama_murid="{{ p.nama_murid }}"
                                 data-kelas="{{ p.kelas }}"
                                 data-kategori="{{ p.kategori_pelanggaran }}"
                                 data-pasal="{{ p.pasal }}"
                                 data-di_input_oleh="{{ p.di_input_oleh }}"
                                 data-tanggal="{{ p.tanggal_kejadian|replace('/', '-')|replace('/', '-') }}">
                                <div class="p-6">
                                    <div class="flex items-start gap-6">
                                        <!-- Image Section -->
                                        <div class="flex-shrink-0">
                                            {% if p.bukti_file %}
                                                <a href="#" class="image-thumbnail block" data-full-image="{{ url_for('static', filename='uploads/' + p.bukti_file) }}">
                                                    <img src="{{ url_for('static', filename='uploads/' + p.bukti_file) }}" alt="Bukti Pelanggaran" class="w-32 h-32 object-cover rounded-lg hover:scale-105 transition-transform duration-300">
                                                </a>
                                            {% else %}
                                                <div class="w-32 h-32 bg-gray-100 rounded-lg flex items-center justify-center">
                                                    <img src="https://placehold.co/150x150/cccccc/333333?text=No+Image" alt="Tidak Ada Bukti" class="w-full h-full object-cover rounded-lg">
                                                </div>
                                            {% endif %}
                                        </div>

                                        <!-- Content Section -->
                                        <div class="flex-1 min-w-0">
                                            <div class="flex justify-between items-start mb-4">
                                                <div>
                                                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Pelanggaran #{{ loop.index }}</h3>
                                                    <div class="flex items-center gap-4 text-sm text-gray-600">
                                                        <span><i class="fas fa-calendar mr-1"></i> {{ p.tanggal_kejadian }}</span>
                                                        <span class="inline-block px-2 py-1 text-xs font-medium rounded-full
                                                            {% if p.kategori_pelanggaran == 'Ringan' %}bg-green-100 text-green-800{% endif %}
                                                            {% if p.kategori_pelanggaran == 'Sedang' %}bg-orange-100 text-orange-800{% endif %}
                                                            {% if p.kategori_pelanggaran == 'Berat' %}bg-red-100 text-red-900{% endif %}">
                                                            {{ p.kategori_pelanggaran }}
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="flex space-x-2">
                                    <button class="action-icon-btn print-btn w-10 h-10 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-full hover:shadow-lg transition-all duration-200 hover:scale-110" 
                                            title="Cetak Data"
                                            onclick="printViolation('{{ p.id }}', '{{ p.nama_murid }}')">
                                        <i class="fas fa-print text-sm"></i>
                                    </button>
                                    <button class="action-icon-btn delete-btn w-10 h-10 bg-gradient-to-r from-danger to-red-600 text-white rounded-full hover:shadow-lg transition-all duration-200 hover:scale-110" 
                                            title="Hapus Data"
                                            onclick="deleteViolation('{{ p.id }}', '{{ p.nama_murid }}')">
                                        <i class="fas fa-trash-alt text-sm"></i>
                                    </button>
                                                </div>
                                            </div>

                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                                <div>
                                                    <p class="text-gray-600 mb-1">Kelas Saat Kejadian</p>
                                                    <p class="font-medium">{{ p.kelas }}</p>
                                                </div>
                                                <div>
                                                    <p class="text-gray-600 mb-1">Pasal</p>
                                                    <p class="font-medium">{{ p.pasal }}</p>
                                                </div>
                                                <div>
                                                    <p class="text-gray-600 mb-1">Di Input Oleh</p>
                                                    <p class="font-medium">{{ p.di_input_oleh }}</p>
                                                </div>
                                                <div>
                                                    <p class="text-gray-600 mb-1">Tanggal Dicatat</p>
                                                    <p class="font-medium">{{ p.tanggal_dicatat.strftime('%d-%m-%Y %H:%M') }}</p>
                                                </div>
                                            </div>

                                            {% if p.deskripsi %}
                                            <div class="mt-4 pt-4 border-t border-gray-100">
                                                <p class="text-gray-600 mb-1 text-sm">Deskripsi</p>
                                                <p class="text-gray-700">{{ p.deskripsi }}</p>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-16">
                        <i class="fas fa-user-check text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 text-lg">Belum ada pelanggaran yang tercatat untuk murid ini.</p>
                        <p class="text-gray-400 text-sm mt-2">Murid ini memiliki catatan yang baik! üëè</p>
                    </div>
                {% endif %}
            </main>
        </div>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 py-3 px-6">
        <div class="text-center">
            <p class="text-gray-600 flex items-center justify-center text-sm">
                <span class="mr-2">‚ú®</span>
                Dibuat dengan ‚ù§Ô∏è oleh Tim IT Alsen 22 &copy; 2025
                <span class="ml-2">‚ú®</span>
            </p>
        </div>
    </footer>
    </div>

    <!-- Modals -->
    <!-- Fullscreen Image Modal -->
    <div id="fullscreenModal" class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden flex items-center justify-center">
        <button class="absolute top-4 right-4 text-white text-3xl hover:text-gray-300 transition-colors duration-200" onclick="closeImageModal()">
            <i class="fas fa-times"></i>
        </button>
        <img class="modal-content max-w-4xl max-h-4xl rounded-lg shadow-2xl" id="fullImage">
        <div class="modal-caption text-white text-center mt-4" id="caption"></div>
        <a id="downloadButton" class="download-button fixed bottom-4 right-4 bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors duration-200" download>
            <i class="fas fa-download mr-2"></i>Unduh Gambar
        </a>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full p-6 transform transition-all duration-300 scale-95 opacity-0" id="deleteModalContent">
            <div class="flex items-center mb-4">
                <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-3">
                    <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                </div>
                <h2 class="text-xl font-bold text-gray-900">Konfirmasi Hapus</h2>
            </div>
            <p class="text-gray-600 mb-4">Anda yakin ingin menghapus data pelanggaran oleh <strong id="studentNameToDelete" class="text-red-600"></strong>? Tindakan ini tidak dapat diurungkan.</p>
            <p class="text-sm text-gray-500 mb-4">Untuk konfirmasi, ketik <strong class="confirm-text bg-red-100 text-red-700 px-2 py-1 rounded">SETUJU</strong> di bawah ini:</p>
            <input type="text" id="deleteConfirmInput" placeholder="Ketik SETUJU" autocomplete="off" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all duration-200">
            <div class="modal-buttons flex space-x-3 mt-6">
                <button id="cancelDeleteBtn" class="flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors duration-200 font-medium">
                    <i class="fas fa-times mr-2"></i>Batal
                </button>
                <button id="confirmDeleteBtn" class="flex-1 px-4 py-2 bg-gradient-to-r from-danger to-red-600 text-white rounded-lg hover:shadow-lg transition-all duration-200 font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    <i class="fas fa-trash mr-2"></i>Hapus Data
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        // Calculate student category statistics
        function updateStudentCategoryStatistics() {
            const violationItems = document.querySelectorAll('.violation-item');
            let ringan = 0, sedang = 0, berat = 0;
            
            violationItems.forEach(item => {
                const categoryElement = item.querySelector('.bg-green-100, .bg-orange-100, .bg-red-100');
                if (categoryElement) {
                    if (categoryElement.classList.contains('bg-green-100')) ringan++;
                    else if (categoryElement.classList.contains('bg-orange-100')) sedang++;
                    else if (categoryElement.classList.contains('bg-red-100')) berat++;
                }
            });
            
            // Update display
            document.getElementById('student-stat-ringan').textContent = ringan;
            document.getElementById('student-stat-sedang').textContent = sedang;
            document.getElementById('student-stat-berat').textContent = berat;
            
            // Update progress bar
            const total = ringan + sedang + berat;
            if (total > 0) {
                const progressRingan = (ringan / total) * 100;
                const progressSedang = (sedang / total) * 100;
                const progressBerat = (berat / total) * 100;
                
                // Create stacked progress bar
                const progressBar = document.getElementById('student-category-progress');
                if (progressBar) {
                    progressBar.innerHTML = `
                        <div class="h-2 transition-all duration-500 flex-shrink-0" style="width: ${progressRingan}%; background-color: #22c55e;"></div>
                        <div class="h-2 transition-all duration-500 flex-shrink-0" style="width: ${progressSedang}%; background-color: #f97316;"></div>
                        <div class="h-2 transition-all duration-500 flex-shrink-0" style="width: ${progressBerat}%; background-color: #b91c1c;"></div>
                    `;
                }
            }
        }
        
        // Calculate student category statistics
        function updateStudentCategoryStatistics() {
            const violationItems = document.querySelectorAll('.violation-item');
            let ringan = 0, sedang = 0, berat = 0;
            
            violationItems.forEach(item => {
                const categoryElement = item.querySelector('.bg-green-100, .bg-orange-100, .bg-red-100');
                if (categoryElement) {
                    if (categoryElement.classList.contains('bg-green-100')) ringan++;
                    else if (categoryElement.classList.contains('bg-orange-100')) sedang++;
                    else if (categoryElement.classList.contains('bg-red-100')) berat++;
                }
            });
            
            // Get the current statistics mode
            const isGlobal = document.getElementById('studentStatsMode').textContent.trim() === 'Global';
            
            if (isGlobal) {
                // Use global statistics from server (displayed directly in template)
                const globalRingan = parseInt('{{ total_ringan if total_ringan is defined else 0 }}');
                const globalSedang = parseInt('{{ total_sedang if total_sedang is defined else 0 }}');
                const globalBerat = parseInt('{{ total_berat if total_berat is defined else 0 }}');
                
                updateStudentStatisticsDisplay(globalRingan, globalSedang, globalBerat);
            } else {
                // Use current student statistics
                updateStudentStatisticsDisplay(ringan, sedang, berat);
            }
        }
        
        function updateStudentStatisticsDisplay(ringan, sedang, berat) {
            // Update display
            document.getElementById('student-stat-ringan').textContent = ringan;
            document.getElementById('student-stat-sedang').textContent = sedang;
            document.getElementById('student-stat-berat').textContent = berat;
            
            // Update progress bar
            const total = ringan + sedang + berat;
            if (total > 0) {
                const progressRingan = (ringan / total) * 100;
                const progressSedang = (sedang / total) * 100;
                const progressBerat = (berat / total) * 100;
                
                // Create stacked progress bar
                const progressBar = document.getElementById('student-category-progress');
                if (progressBar) {
                    progressBar.innerHTML = `
                        <div class="h-2 transition-all duration-500 flex-shrink-0" style="width: ${progressRingan}%; background-color: #22c55e;"></div>
                        <div class="h-2 transition-all duration-500 flex-shrink-0" style="width: ${progressSedang}%; background-color: #f97316;"></div>
                        <div class="h-2 transition-all duration-500 flex-shrink-0" style="width: ${progressBerat}%; background-color: #b91c1c;"></div>
                    `;
                }
            }
        }
        
        // Print functionality (same as index page)
        function printViolation(violationId, studentName) {
            console.log('Student History: Print function called with ID:', violationId, 'Student:', studentName);
            
            const violationItem = document.querySelector(`[data-id="${violationId}"]`);
            
            if (violationItem) {
                // Get violation data
                const kelas = violationItem.querySelector('[data-kelas]')?.dataset.kelas || '';
                const kategori = violationItem.querySelector('.bg-green-100, .bg-orange-100, .bg-red-100')?.textContent.trim() || '';
                const pasal = violationItem.querySelector('[data-pasal]')?.dataset.pasal || '';
                const tanggal = violationItem.querySelector('[data-tanggal]')?.dataset.tanggal || '';
                const deskripsi = violationItem.querySelectorAll('p')[3]?.textContent || '';
                const inputOleh = violationItem.querySelector('[data-di_input_oleh]')?.dataset.di_input_oleh || '';
                
                // Create print content
                const printContent = `
                    <div style="font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto;">
                        <h2 style="color: #667eea; border-bottom: 2px solid #667eea; padding-bottom: 10px;">Data Pelanggaran - ${studentName}</h2>
                        <div style="margin: 20px 0;">
                            <p><strong>Nama Murid:</strong> ${studentName}</p>
                            <p><strong>Kelas:</strong> ${kelas}</p>
                            <p><strong>Kategori:</strong> ${kategori}</p>
                            <p><strong>Pasal:</strong> ${pasal}</p>
                            <p><strong>Tanggal Kejadian:</strong> ${tanggal}</p>
                            <p><strong>Di Input Oleh:</strong> ${inputOleh}</p>
                            ${deskripsi ? `<p><strong>Deskripsi:</strong> ${deskripsi}</p>` : ''}
                        </div>
                        <div style="margin-top: 30px; font-size: 12px; color: #666;">
                            <p>Dicetak pada: ${new Date().toLocaleString('id-ID')}</p>
                        </div>
                    </div>
                `;
                
                // Open print window
                const printWindow = window.open('', '_blank');
                printWindow.document.write(printContent);
                printWindow.document.close();
                printWindow.print();
            }
        }
        
        // Delete functionality (same as index page)
        function deleteViolation(violationId, studentName) {
            console.log('Student History: Delete function called with ID:', violationId, 'Student:', studentName);
            
            // Set the student name in the modal
            document.getElementById('studentNameToDelete').textContent = studentName;
            
            // Show the modal
            const modal = document.getElementById('deleteConfirmModal');
            const modalContent = modal.querySelector('#deleteModalContent');
            
            modal.classList.remove('hidden');
            modalContent.classList.remove('scale-95', 'opacity-0');
            setTimeout(() => {
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
            
            // Store the violation ID for deletion
            window.violationToDelete = violationId;
        }
        
        // Initialize statistics when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Statistics toggle functionality
            document.getElementById('toggleStudentStats').addEventListener('click', function() {
                const globalStats = document.getElementById('globalStudentStats');
                const currentStats = document.getElementById('currentStudentStats');
                const statsMode = document.getElementById('studentStatsMode');
                
                if (globalStats.classList.contains('hidden')) {
                    // Show global stats
                    globalStats.classList.remove('hidden');
                    currentStats.classList.add('hidden');
                    statsMode.textContent = 'Global';
                    this.querySelector('i').className = 'fas fa-globe mr-1';
                } else {
                    // Show student stats
                    globalStats.classList.add('hidden');
                    currentStats.classList.remove('hidden');
                    statsMode.textContent = 'Siswa Ini';
                    this.querySelector('i').className = 'fas fa-user mr-1';
                }
                
                updateStudentCategoryStatistics();
            });
            
            // Cancel delete button
            document.getElementById('cancelDeleteBtn').addEventListener('click', function() {
                closeModal();
            });
            
            // Confirm delete button
            document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
                confirmDelete();
            });
            
            // Delete confirmation input
            document.getElementById('deleteConfirmInput').addEventListener('input', function() {
                const input = this.value.trim();
                const confirmBtn = document.getElementById('confirmDeleteBtn');
                if (input === 'SETUJU') {
                    confirmBtn.disabled = false;
                    confirmBtn.classList.remove('disabled:opacity-50', 'disabled:cursor-not-allowed');
                } else {
                    confirmBtn.disabled = true;
                    confirmBtn.classList.add('disabled:opacity-50', 'disabled:cursor-not-allowed');
                }
            });
            
            // Close modal when clicking outside
            document.getElementById('deleteConfirmModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
            
            updateStudentCategoryStatistics();
        });
        
        // Modal helper functions
        function closeModal() {
            const modal = document.getElementById('deleteConfirmModal');
            const modalContent = modal.querySelector('#deleteModalContent');
            
            modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 200);
        }
        
        function confirmDelete() {
            if (window.violationToDelete) {
                // Create and submit form
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/delete/${window.violationToDelete}`;
                
                // Add CSRF token (if needed)
                const csrfToken = document.querySelector('meta[name="csrf-token"]');
                if (csrfToken) {
                    const csrfInput = document.createElement('input');
                    csrfInput.type = 'hidden';
                    csrfInput.name = 'csrf_token';
                    csrfInput.value = csrfToken.getAttribute('content');
                    form.appendChild(csrfInput);
                }
                
                // Submit form
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
</body>
</html>